(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(A){A.defineMode("velocity",function(){function D(O){var N={},L=O.split(" ");for(var M=0;M<L.length;++M){N[L[M]]=true}return N}var E=D("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}");var I=D("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}");var C=D("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent");var K=/[+\-*&%=<>!?:\/|]/;function B(N,M,L){M.tokenize=L;return L(N,M)}function F(P,N){var L=N.beforeParams;N.beforeParams=false;var M=P.next();if((M=="'")&&N.inParams){N.lastTokenWasBuiltin=false;return B(P,N,J(M))}else{if((M=='"')){N.lastTokenWasBuiltin=false;if(N.inString){N.inString=false;return"string"}else{if(N.inParams){return B(P,N,J(M))}}}else{if(/[\[\]{}\(\),;\.]/.test(M)){if(M=="("&&L){N.inParams=true}else{if(M==")"){N.inParams=false;N.lastTokenWasBuiltin=true}}return null}else{if(/\d/.test(M)){N.lastTokenWasBuiltin=false;P.eatWhile(/[\w\.]/);return"number"}else{if(M=="#"&&P.eat("*")){N.lastTokenWasBuiltin=false;return B(P,N,H)}else{if(M=="#"&&P.match(/ *\[ *\[/)){N.lastTokenWasBuiltin=false;return B(P,N,G)}else{if(M=="#"&&P.eat("#")){N.lastTokenWasBuiltin=false;P.skipToEnd();return"comment"}else{if(M=="$"){P.eatWhile(/[\w\d\$_\.{}]/);if(C&&C.propertyIsEnumerable(P.current())){return"keyword"}else{N.lastTokenWasBuiltin=true;N.beforeParams=true;return"builtin"}}else{if(K.test(M)){N.lastTokenWasBuiltin=false;P.eatWhile(K);return"operator"}else{P.eatWhile(/[\w\$_{}@]/);var O=P.current();if(E&&E.propertyIsEnumerable(O)){return"keyword"}if(I&&I.propertyIsEnumerable(O)||(P.current().match(/^#@?[a-z0-9_]+ *$/i)&&P.peek()=="(")&&!(I&&I.propertyIsEnumerable(O.toLowerCase()))){N.beforeParams=true;N.lastTokenWasBuiltin=false;return"keyword"}if(N.inString){N.lastTokenWasBuiltin=false;return"string"}if(P.pos>O.length&&P.string.charAt(P.pos-O.length-1)=="."&&N.lastTokenWasBuiltin){return"builtin"}N.lastTokenWasBuiltin=false;return null}}}}}}}}}}function J(L){return function(Q,O){var N=false,P,M=false;while((P=Q.next())!=null){if((P==L)&&!N){M=true;break}if(L=='"'&&Q.peek()=="$"&&!N){O.inString=true;M=true;break}N=!N&&P=="\\"}if(M){O.tokenize=F}return"string"}}function H(O,M){var N=false,L;while(L=O.next()){if(L=="#"&&N){M.tokenize=F;break}N=(L=="*")}return"comment"}function G(O,M){var N=0,L;while(L=O.next()){if(L=="#"&&N==2){M.tokenize=F;break}if(L=="]"){N++}else{if(L!=" "){N=0}}}return"meta"}return{startState:function(){return{tokenize:F,beforeParams:false,inParams:false,inString:false,lastTokenWasBuiltin:false}},token:function(M,L){if(M.eatSpace()){return null}return L.tokenize(M,L)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}});A.defineMIME("text/velocity","velocity")});