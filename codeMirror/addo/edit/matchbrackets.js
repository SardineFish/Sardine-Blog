(function(A){if(typeof exports=="object"&&typeof module=="object"){A(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],A)}else{A(CodeMirror)}}})(function(H){var C=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var D=H.Pos;var G={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function F(N,L,P,J){var K=N.getLineHandle(L.line),R=L.ch-1;var M=(R>=0&&G[K.text.charAt(R)])||G[K.text.charAt(++R)];if(!M){return null}var O=M.charAt(1)==">"?1:-1;if(P&&(O>0)!=(R==L.ch)){return null}var Q=N.getTokenTypeAt(D(L.line,R+1));var S=B(N,D(L.line,R+(O>0?1:0)),O,Q||null,J);if(S==null){return null}return{from:D(L.line,R),to:S&&S.pos,match:S&&S.ch==M.charAt(0),forward:O>0}}function B(P,M,Q,S,K){var W=(K&&K.maxScanLineLength)||10000;var T=(K&&K.maxScanLines)||1000;var Y=[];var U=K&&K.bracketRegex?K.bracketRegex:/[(){}[\]]/;var O=Q>0?Math.min(M.line+T,P.lastLine()+1):Math.max(P.firstLine()-1,M.line-T);for(var X=M.line;X!=O;X+=Q){var L=P.getLine(X);if(!L){continue}var N=Q>0?0:L.length-1,J=Q>0?L.length:-1;if(L.length>W){continue}if(X==M.line){N=M.ch-(Q<0?1:0)}for(;N!=J;N+=Q){var R=L.charAt(N);if(U.test(R)&&(S===undefined||P.getTokenTypeAt(D(X,N+1))==S)){var V=G[R];if((V.charAt(1)==">")==(Q>0)){Y.push(R)}else{if(!Y.length){return{pos:D(X,N),ch:R}}else{Y.pop()}}}}}return X-Q==(Q>0?P.lastLine():P.firstLine())?false:null}function I(L,K,J){var Q=L.state.matchBrackets.maxHighlightLineLength||1000;var O=[],P=L.listSelections();for(var M=0;M<P.length;M++){var R=P[M].empty()&&F(L,P[M].head,false,J);if(R&&L.getLine(R.from.line).length<=Q){var N=R.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";O.push(L.markText(R.from,D(R.from.line,R.from.ch+1),{className:N}));if(R.to&&L.getLine(R.to.line).length<=Q){O.push(L.markText(R.to,D(R.to.line,R.to.ch+1),{className:N}))}}}if(O.length){if(C&&L.state.focused){L.focus()}var S=function(){L.operation(function(){for(var T=0;T<O.length;T++){O[T].clear()}})};if(K){setTimeout(S,800)}else{return S}}}var A=null;function E(J){J.operation(function(){if(A){A();A=null}A=I(J,false,J.state.matchBrackets)})}H.defineOption("matchBrackets",false,function(L,K,J){if(J&&J!=H.Init){L.off("cursorActivity",E)}if(K){L.state.matchBrackets=typeof K=="object"?K:{};L.on("cursorActivity",E)}});H.defineExtension("matchBrackets",function(){I(this,true)});H.defineExtension("findMatchingBracket",function(K,J,L){return F(this,K,J,L)});H.defineExtension("scanForBracket",function(K,J,L,M){return B(this,K,J,L,M)})});