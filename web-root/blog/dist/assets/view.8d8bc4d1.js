import"./modulepreload-polyfill.c7c6310f.js";const view="";function $(t){return document.querySelector(t)}function $$(t){return document.querySelectorAll(t)}function addClass(t,n){return[t].concat(n).join(" ")}var cid=0,pid=0;window.onload=function(){HTMLTemplate.Init(),initTopBar();let t=/\d+$/.exec(window.location.pathname);if(t)cid=pid=parseInt(t[0]);else if(t=/pid=(\d+)/.exec(window.location.search),t)cid=pid=parseInt(t[1]);else throw new Error("Invalid url");loadBlog(pid),loadComment(pid),checkLogin(),initCommentPost(),window.addEventListener("scroll",()=>{var n=document.querySelector("#side-area"),o=n.getBoundingClientRect();o.top+o.height<=0?document.querySelector("#side-float").className="show":document.querySelector("#side-float").className="hide"}),$("#button-to-top").addEventListener("click",()=>{scrollToTop(.5)})};function scrollToTop(t){var n=.01667,o=window.scrollY/(t/n);window.scrollTo(0,window.scrollY-o),window.scrollY>0&&setTimeout(()=>scrollToTop(t-n),16)}function checkLogin(){$("#login").href="/account/login?redirect="+encodeURIComponent(window.location),SardineFish.API.User.checkAuth({}).then(t=>{document.querySelector("#account-area").className="login",document.querySelector("#user-avatar").src=`/api/user/${t}/avatar`,SardineFish.API.User.getInfo({}).then(n=>{$("#sender-avatar").src=n.avatar,$("#input-name").value=n.name,$("#input-email").value=n.email})})}function initSearch(){let t=!1;$("#search .icon-search").onclick=()=>{const n=$("#search-input").value;t?n?$("#search").submit():(t=!1,$("#search").classList.remove("expand")):(t=!0,$("#search").classList.add("expand"))}}function initTopBar(){var t=!1;$("#button-menu").addEventListener("click",function(){t?$("#top").classList.remove("extend-side"):$("#top").classList.add("extend-side"),t=!t}),initSearch()}function loadBlog(pid){var hljsLib="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1";$("#write").href="/blog/write/?pid="+pid,SardineFish.API.Blog.getByPid({pid}).then(data=>{if(data.time=SardineFish.API.Utils.formatDateTime(new Date(data.time)),data.doc_type===SardineFish.API.DocType.Markdown){var unknowLanguages={};if(new Date(data.time).getTime()<1546272e6){var renderer=markedImagePostProcess(marked);marked.setOptions({highlight:function(str,lang,callback){if(lang&&hljs.getLanguage(lang))try{return hljs.highlight(lang,str).value}catch{}else lang&&!unknowLanguages[lang]&&(unknowLanguages[lang]=fetch(`${hljsLib}/languages/${lang}.min.js`).then(t=>t.text()).then(code=>{eval(code),$$(`code.lang-${lang}`).forEach(t=>hljs.highlightBlock(t))}));return hljs.highlightAuto(str).value},renderer}),data.doc=marked(data.doc)}else{var md=window.markdownit({html:!0,xhtmlOut:!1,breaks:!0,langPrefix:"lang-",linkify:!0,typographer:!1,highlight:function(t,n){if(n&&hljs.getLanguage(n))try{return hljs.highlight(n,t).value}catch{}else n&&(unknowLanguages[n]=!0);return hljs.highlightAuto(t).value}});markdownItImagePostProcess(md),md.use(markdownitEmoji),md.use(markdownitKatex),data.doc=md.render(data.doc),Object.keys(unknowLanguages).forEach(lang=>{fetch(`${hljsLib}/languages/${lang}.min.js`).then(t=>t.text()).then(code=>{eval(code),$$(`code.lang-${lang}`).forEach(t=>hljs.highlightBlock(t))})})}}document.querySelector("#article-template").dataSource=data,loadContentNav(),$("#page-title").innerText=data.title,$("#loading").style.display="none",$$(".hide-loading").forEach(t=>t.className=t.className.replace("hide-loading","")),document.head.title=document.title=data.title,Promise.resolve().then(()=>{document.querySelectorAll("app").forEach(loadApp)})}).catch(t=>{switch(t.code){case 197122:t.code=404;break;default:t.code=`0x${t.code.toString(16)}`}$("#error-code").innerText=t.code,$("#load-error").className="show",$("#sun").onclick=()=>{$("#root").className.includes("darken")?$("#root").className=$("#root").className.replace("darken",""):$("#root").className=addClass($("#root").className,"darken")},loadPuzzle()})}function loadApp(t){const n=t.getAttribute("src"),o=t.getAttribute("name"),d=t.getAttribute("scale")||1,a=document.createElement("iframe"),s=document.createElement("div");{s.className="app-wrapper";const l=document.createElement("div");{l.className="app";const i=document.createElement("div");{i.className="cover";const c=document.createElement("header");c.innerText=o,i.appendChild(c);const u=document.createElement("div");u.className="button",u.innerText="CLICK TO LOAD",u.onclick=()=>{u.onclick=null,a.src=n,l.classList.add("load")},i.appendChild(u)}l.appendChild(i);{a.className="external";const c=t.getBoundingClientRect();console.log(c),a.width=c.width,a.height=window.innerWidth>window.innerHeight?Math.floor(a.width*9/16):Math.floor(a.width*16/9),l.style.width=`${a.width}px`,l.style.height=`${a.height}px`,a.width/=d,a.height/=d,a.style.transform=`scale(${d})`,a.style.transformOrigin="top left"}l.appendChild(a)}s.appendChild(l);const r=document.createElement("div");r.className="panel",r.innerHTML=`
<div class="icon-button button-reload">refresh</div>
<a class="icon-button button-new-tab" href="${n}" target="_blank">open_in_new</a>
<div class="icon-button button-full-window">aspect_ratio</div>
<div class="icon-button button-full-screen">fullscreen</div>
`,r.querySelector(".button-reload").onclick=()=>a.src=n,r.querySelector(".button-full-window").onclick=()=>{document.body.classList.add("full-window"),l.classList.add("full-window"),l.style.width="",l.style.height="",Promise.resolve().then(()=>h())},r.querySelector(".button-full-screen").onclick=()=>l.requestFullscreen({navigationUI:"hide"}),s.appendChild(r);const h=()=>{const i=l.getBoundingClientRect();console.log(i),a.width=i.width,a.height=window.innerWidth>window.innerHeight?Math.floor(a.width*9/16):Math.floor(a.width*16/9)};window.addEventListener("resize",h),l.addEventListener("fullscreenchange",h)}t.appendChild(s)}function loadContentNav(){setTimeout(function(){var t=document.querySelector(".markdown-body"),n=document.querySelectorAll("#content-template"),o=Array.from(t.querySelectorAll("h2,h3,h4,h5,h6,h7,h8,h9"));const d=r=>{for(var h={header:"",url:"#",children:[]};a<o.length;a++){var i=parseInt(/H(\d)/.exec(o[a].tagName)[1]);if(o[a].id=o[a].innerText,i>=r){if(h.header!=""&&i<=r)return a--,h;i==r?h={header:o[a].innerText,url:`${location.protocol}//${location.host}${location.pathname}${location.search}#${o[a].id}`,children:[]}:i>r&&h.children.push(d(r+1))}else return a--,h}return h};var a=0,s=[];for(a=0;a<o.length;a++)s.push(d(2));var l={header:$("#title").innerText,url:`${location.protocol}//${location.host}${location.pathname}${location.search}#title`,children:s};n.forEach(r=>r.dataSource=l)})}function formatTime(t){t.time=SardineFish.API.Utils.formatDateTime(new Date(t.time)),t.comments.forEach(formatTime)}function loadComment(t){SardineFish.API.Comment.getByPid({pid:t,depth:6}).then(n=>{n.forEach(formatTime);var o=document.querySelector("#comment-template");n=n.sort((d,a)=>a.pid-d.pid),o.dataSource=n,$$(".comment-render .comment").forEach(function(d){var a=d.dataset.pid,s=d.dataset.name;d.querySelector(".button-reply").addEventListener("click",function(){window.cid=parseInt(a),$("#input-comment").dataset.text="Reply to "+s,$("#input-comment").innerHTML=""})})})}function initCommentPost(){$("#button-add-comment").addEventListener("click",function(){cid=pid,$("#input-comment").dataset.text="Tell me what you think",$("#input-comment").innerHTML=""}),$("#button-comment-send").addEventListener("click",function(){var t=$("#input-name").value,n=$("#input-email").value,o=$("#input-comment").innerText,d=CryptoJS.MD5(n).toString(),a=`https://www.gravatar.com/avatar/${d}?s=256&d=${encodeURIComponent("https://cdn-static.sardinefish.com/img/unknown-user-grey.png")}`;SardineFish.API.Comment.post({pid:cid},{name:t,email:n,text:o,avatar:a}).then(()=>{$("#input-comment").innerHTML="",loadComment(pid)})})}function loadPuzzle(){require.config({paths:{"crypto-js":"/lib/Script/crypto-js"}}),require(["crypto-js/crypto-js"],function(CryptoJS){var ans="U2FsdGVkX1/A4SaZPLVgnDY3SJxhtkwV8EgRK3WYb+spfsIOaicFaHfBBJ7ZE9lechvHNqLNQaQhAjVJxKji+w==",ansHash="ec1599cd561886e2e75238c6e826f48135dc0f7cf1d14f61cf36d1b5e5c20ae5",hints=["\u4F60\u4E00\u5B9A\u662F\u591C\u7A7A\u4E2D\u6700\u4EAE\u7684\u90A3\u9897\u2B50","\u795E\u8BF4\uFF0C\u8981\u6709\u5149\u3002","\u8FD9\u91CC\u4EC0\u4E48\u4E5F\u6CA1\u6709\uFF0C\u5173\u706F\u7761\u5427\u3002"];window.CryptoJS=CryptoJS;function AES_CBC_Decrypt(t,n){return CryptoJS.AES.decrypt(t,n,{mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.ZeroPadding}).toString(CryptoJS.enc.Utf8)}$$("*").forEach(el=>el.addEventListener("click",e=>{try{var x=Math.floor(e.pageX/2),y=Math.floor(e.pageY/2),key=`(${x}, ${y})`,dec=AES_CBC_Decrypt(ans,key),decHash=CryptoJS.SHA256(dec);decHash!=ansHash?$("#error-msg").innerText=hints[parseInt(Math.random()*hints.length)]:eval(dec)}catch(t){$("#error-msg").innerText=hints[parseInt(Math.random()*hints.length)]}}))})}function markdownItImagePostProcess(t){var n=t.renderer.rules.image,o="https://img.sardinefish.com/",d=/((?:https?:)?\/\/[^/]*.sardinefish.com\/)(.*)/;atob("aHR0cDovL2ltZy5zYXJkaW5lZmlzaC5jb20v"),t.renderer.rules.image=function(a,s,l,r,h){var i=a[s],c=i.attrs[i.attrIndex("src")][1];if(d.test(c)){var u=d.exec(c)[2];c=o+u}return console.log(`${i.attrs[i.attrIndex("src")][1]} -> ${c}`),i.attrs[i.attrIndex("src")][1]=c,n(a,s,l,r,h)}}function markedImagePostProcess(t){var n=new t.Renderer,o=n.image,d="https://cdn-img.sardinefish.com/",a="http://img.sardinefish.com/",s=/((?:https?:)?\/\/[^/]*.sardinefish.com\/)(.*)/,l=atob("aHR0cDovL2ltZy5zYXJkaW5lZmlzaC5jb20v");return n.image=function(r,h,i){var c=r;if(s.test(c)){var u=s.exec(c)[2];window.location.protocol==="https:"?c=d+u:c=a+u}return c=a.replace(l,c),console.log(`${r} -> ${c}`),r=c,o.bind(n)(r,h,i)},n}
